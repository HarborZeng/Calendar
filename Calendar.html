<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleCalendar</title>
    <link href="css/styleCalendar.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<div class="calendar-container">
    <div class="calendar">
        <div class="calendar-head">
            <div class="calendar-arrow calendar-arrow-left" id="pre-month-btn" onclick="changeCalendarBody(0)">
                <span>&lt</span>
            </div>
            <div class="calendar-month_year">
                <div class="calendar-display">
                    <p id="month">AUGUST</p>
                    <p id="year">2016</p>
                </div>
            </div>
            <div class="calendar-arrow calendar-arrow-right" id="next-month-btn" onclick="changeCalendarBody(1)">
                <span>&gt</span>
            </div>
        </div>
        <div class="calendar-body">
            <div class="calendar-day_of_week-container">
                <ul>
                    <li>Mo</li>
                    <li>Tu</li>
                    <li>We</li>
                    <li>Th</li>
                    <li>Fr</li>
                    <li>Sa</li>
                    <li>Su</li>
                </ul>
            </div>
            <div class="calendar-days-container">
                <ul id="calendar-days-list">

                </ul>
            </div>
        </div>
    </div>
</div>
<script>
    var now = new Date();

    function init() {
        drawBody(now);
        setUpHeader(now.getFullYear(), now.getMonth());
    }

    function changeCalendarBody(direction) {
        console.log('点击了' + direction);
        if (direction === 0) {
            if (now.getMonth() === 0) {
                now.setMonth(11);
                now.setFullYear(now.getFullYear() - 1);
            } else {
                now.setMonth(now.getMonth() - 1);
            }
        } else if (direction === 1) {
            if (now.getMonth() === 11) {
                now.setMonth(0);
                now.setFullYear(now.getFullYear() + 1);
            } else {
                now.setMonth(now.getMonth() + 1);
            }
        } else {
            throw new Error('只能点击下一月和上一月');
        }
        drawBody(now);

        setUpHeader(now.getFullYear(), now.getMonth());
    }

    function drawBody(now) {
        var counter = 0;
        var date = now.getDate();
        var daysList = document.getElementById('calendar-days-list');
        while (daysList.hasChildNodes()) {
            daysList.removeChild(daysList.firstChild);
        }
        var daysBelongToLastMonth = (7 - (date % 7 - now.getDay())) % 7;
        var totalDays = numberOfDaysInLastMonth(now);
        //打印上个月剩下的几天
        for (var i = daysBelongToLastMonth; i > 0; i--) {
            var listItem = document.createElement('li');
            var a = document.createElement('a');
            //+1的原因：25-30总共6天，但30-25=6
            a.innerText = totalDays - i + 1;
            a.style.color = '#BBB';
            listItem.appendChild(a);
            daysList.appendChild(listItem);
            counter++;
        }

        //打印本月的日子
        var numberOfDaysThisMonth = numberOfDaysInMonth(now);
        for (var d = 1; d <= numberOfDaysThisMonth; d++) {
            var listItem = document.createElement('li');
            var a = document.createElement('a');
            a.innerText = d;
            if (d === now.getDate()){
                a.setAttribute('id', 'today-list-item')
            }
            listItem.appendChild(a);
            daysList.appendChild(listItem);
            counter++;
        }

        if (counter % 7 !== 0) {
            for (var j = 1; j <= 7 - (counter % 7); j++) {
                var listItem = document.createElement('li');
                var a = document.createElement('a');
                a.innerText = j;
                a.style.color = '#BBB';
                listItem.appendChild(a);
                daysList.appendChild(listItem);
            }
        }

        setUpToday();
    }

    function isLeapYear(fullYear) {
        if (fullYear % 100 !== 0) {
            return fullYear % 4 === 0 ? 1 : 0;
        } else {
            return fullYear % 400 === 0 ? 1 : 0;
        }
    }

    function numberOfDaysInLastMonth(now) {
        var copy = new Date(now);
        if (copy.getMonth() === 0) {
            copy.setMonth(11);
            copy.setFullYear(now.getFullYear() - 1)
        } else {
            copy.setMonth(copy.getMonth() - 1)
        }
        return numberOfDaysInMonth(copy);
    }

    /**
     * 返回这个月的天数
     */
    function numberOfDaysInMonth(copy) {
        var daysInMonths = [31, 28 + isLeapYear(copy.getFullYear()),
            31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        return daysInMonths[copy.getMonth()];
    }

    /**
     * 此方法将当前日期着色为墨绿色
     */
    function setUpToday() {
        var today = new Date();
        if (today.getMonth() === now.getMonth()) {
            var todayId = document.getElementById('today-list-item');
            todayId.style.backgroundColor='#00c1ac'
        }
        //var year = now.getYear();   //从1900年开始算起
//        var month = now.getMonth(); //从0月开始算起
//        var date = now.getDate();   //例如10月22日的22日
//        var day = now.getDay();     //星期几,从0开始
    }


    function setUpHeader(fullYear, month) {
        var yearHeader = document.getElementById('year');
        yearHeader.innerText = fullYear;

        var monthNames = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',
            'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'];
        var monthHeader = document.getElementById('month');
        monthHeader.innerText = monthNames[month];
    }


    init();
</script>
</body>
</html>